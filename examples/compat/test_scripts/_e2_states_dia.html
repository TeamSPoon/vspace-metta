<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title></title>
<style type="text/css">
.ansi2html-content { display: inline; white-space: pre-wrap; word-wrap: break-word; }
.body_foreground { color: #AAAAAA; }
.body_background { background-color: #000000; }
.inv_foreground { color: #000000; }
.inv_background { background-color: #AAAAAA; }
.ansi1 { font-weight: bold; }
.ansi32 { color: #00aa00; }
.ansi33 { color: #aa5500; }
.ansi38-000068000 { color: #004400; }
.ansi38-255165000 { color: #FFA500; }
.ansi38-255165000 { color: #FFA500; }
.ansi38-255165000 { color: #FFA500; }
.ansi38-255165000 { color: #FFA500; }
.ansi38-255165000 { color: #FFA500; }
.ansi38-255165000 { color: #FFA500; }
.ansi38-255165000 { color: #FFA500; }
.ansi38-255165000 { color: #FFA500; }
.ansi38-255165000 { color: #FFA500; }
</style>
</head>
<body class="body_foreground body_background" style="font-size: normal;" >
<pre class="ansi2html-content">
Script started on 2023-09-23 00:32:13-07:00 [COMMAND="timeout --foreground --preserve-status 60 swipl --debug=true -l /opt/logicmoo_workspace/packs_sys/logicmoo_opencog/MeTTa/vspace-metta/metta_vspace/pyswip/metta_interp.pl -- --python=enable /opt/logicmoo_workspace/packs_sys/logicmoo_opencog/MeTTa/vspace-metta/examples/compat/test_scripts/_e2_states_dia.metta --repl=false --args --timeout=60 --html" TERM="xterm" TTY="/dev/pts/0" COLUMNS="191" LINES="197"]
% init_phase(after_load).
% dot_cfg:using_dot_type(core,user)
:- time_factorials(61111).
:- time_fibonaccis(30000)
 --python=enable

  (load_metta  &amp;self "/opt/logicmoo_workspace/packs_sys/logicmoo_opencog/MeTTa/vspace-metta/examples/compat/test_scripts/_e2_states_dia.metta")
  (track_load_into_file  "/opt/logicmoo_workspace/packs_sys/logicmoo_opencog/MeTTa/vspace-metta/examples/compat/test_scripts/_e2_states_dia.metta")
;; This example rewritten with `case` works (as per 19 Oct 22),
;; but it might not be good as a unit test:
;; - what''s going on is not obvious
;; - there might be a better way to implement what the code is doing
;; - processing commands with side effect and empty results and
;;   chaining them might not be idiomatic
;; - it''s relatively slow (why? FIXME?)
<span class="ansi38-000068000">! (bind! &amp;memory 
    (new-space))
</span><span class="ansi33"> % ['new-space']

</span>; catching empty results
<span class="ansi38-255165000">  (metta_type  &amp;self do 
    (-&gt; Atom %Undefined%))
</span>  (metta_arity  &amp;self do 2)
  (metta_params  &amp;self do 
    (Atom %Undefined%))
  (metta_last  &amp;self do %Undefined%)<span class="ansi38-255165000">
  (metta_defn  &amp;self 
    (do $Expr) 
    (case $Expr 
      ( ($X $X) 
        (%void% None))))
</span>; `remove-state` will return an empty result if there is no
; corresponding state in the memory
<span class="ansi38-255165000">  (metta_defn  &amp;self 
    (remove-state $Var) 
    (match &amp;memory 
      (state $Var $Y) 
      (call:remove_atom &amp;memory 
        (state $Var $Y))))
</span>; using `do` assures that the next clause will be executed
; even if the result of the previous clause is empty
<span class="ansi38-255165000">  (metta_defn  &amp;self 
    (change-state $Var $Value) 
    (nop 
      (do 
        (remove-state $Var)) 
      (do 
        (add-atom &amp;memory 
          (state $Var $Value)))))
</span><span class="ansi38-255165000">  (metta_defn  &amp;self 
    (get-state $Var) 
    (match &amp;memory 
      (state $Var $Value) $Value))
</span>; Earlier, `(get-state (person name))` got cached, and it changes
; in one equality for `listen` didn''t affect other equalities.
; `case` accepts an `Atom` and forcefully evaluates it.
; However, the idea of using equalities as sequentially processed
; rules with side effects is still questionable
<span class="ansi38-255165000">  (metta_defn  &amp;self 
    (listen 
      (My name is $X)) 
    (case 
      (get-state 
        (person name)) 
      ( ($X 
          ("Yes," I remember)) 
        ($Y 
          (I thought you are $Y)))))
</span>; $y cannot be %void%
<span class="ansi38-255165000">  (metta_defn  &amp;self 
    (listen 
      (My name is $X)) 
    (change-state 
      (person name) $X))
  (metta_defn  &amp;self 
    (listen 
      (My name is $_295002)) 
    (change-state 
      (person name) $_295002))  ; 10 

</span><span class="ansi38-255165000">  (metta_defn  &amp;self 
    (listen $_) 
    (case 
      (get-state greeted) 
      ( (%void% 
          (case 
            (get-state 
              (person name)) 
            ( (%void% 
                (Hi. What is your name?)) 
              ($P_name 
                (Nice to meet you $P_name))))))))
  (metta_defn  &amp;self 
    (listen $_311586) 
    (case 
      (get-state greeted) 
      ( (%void% 
          (case 
            (get-state 
              (person name)) 
            ( (%void% 
                (Hi. What is your name?)) 
              ($_311938 
                (Nice to meet you $_311938))))))))  ; 11 

</span><span class="ansi38-255165000">  (metta_defn  &amp;self 
    (listen $_) 
    (nop 
      (change-state greeted True)))
  (metta_defn  &amp;self 
    (listen $_319340) 
    (nop 
      (change-state greeted True)))  ; 12 

</span><span class="ansi32">% 98,430 inferences, 0.052 CPU in 0.052 seconds (100% CPU, 1891026 Lips)
</span>  (=  "/opt/logicmoo_workspace/packs_sys/logicmoo_opencog/MeTTa/vspace-metta/examples/compat/test_scripts/_e2_states_dia.metta" 12)
 --repl=false
 --args
 --timeout=60
<span class="ansi1">LoonIt Report
</span>------------
<span class="ansi33">Nothing to report
</span>
Script done on 2023-09-23 00:32:15-07:00 [COMMAND_EXIT_CODE="7"]

</pre>
</body>

</html>
