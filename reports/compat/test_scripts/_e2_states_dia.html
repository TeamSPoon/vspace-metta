<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title></title>
<style type="text/css">
.ansi2html-content { display: inline; white-space: pre-wrap; word-wrap: break-word; }
.body_foreground { color: #AAAAAA; }
.body_background { background-color: #000000; }
.inv_foreground { color: #000000; }
.inv_background { background-color: #AAAAAA; }
.ansi32 { color: #00aa00; }
.ansi33 { color: #aa5500; }
.ansi38-000068000 { color: #004400; }
.ansi38-255165000 { color: #FFA500; }
.ansi38-255165000 { color: #FFA500; }
.ansi38-255165000 { color: #FFA500; }
.ansi38-255165000 { color: #FFA500; }
.ansi38-255165000 { color: #FFA500; }
.ansi38-255165000 { color: #FFA500; }
.ansi38-255165000 { color: #FFA500; }
.ansi38-255165000 { color: #FFA500; }
.ansi38-255165000 { color: #FFA500; }
</style>
</head>
<body class="body_foreground body_background" style="font-size: normal;" >
<pre class="ansi2html-content">
 (@ track_load_into_file "/opt/logicmoo_workspace/packs_sys/logicmoo_opencog/MeTTa/vspace-metta/examples/compat/test_scripts/_e2_states_dia.metta")
;; This example rewritten with `case` works (as per 19 Oct 22),
;; but it might not be good as a unit test:
;; - what''s going on is not obvious
;; - there might be a better way to implement what the code is doing
;; - processing commands with side effect and empty results and
;;   chaining them might not be idiomatic
;; - it''s relatively slow (why? FIXME?)
<span class="ansi38-000068000">!(bind! &amp;memory (new-space))
</span>
<span class="ansi33">  (new-space)

</span>; catching empty results
<span class="ansi38-255165000">(@ = load 
  (metta_type  &amp;self do 
    (-&gt; Atom %Undefined%)))
</span><span class="ansi38-255165000">(@ = load 
  (metta_defn  &amp;self 
    (do $Expr) 
    (case $Expr 
      ( ($X $X) 
        (%void% None)))))
</span>; `remove-state` will return an empty result if there is no
; corresponding state in the memory
<span class="ansi38-255165000">(@ = load 
  (metta_defn  &amp;self 
    (remove-state $Var) 
    (match &amp;memory 
      (state $Var $Y) 
      (call:remove_atom &amp;memory 
        (state $Var $Y)))))
</span>; using `do` assures that the next clause will be executed
; even if the result of the previous clause is empty
<span class="ansi38-255165000">(@ = load 
  (metta_defn  &amp;self 
    (change-state $Var $Value) 
    (nop 
      (do 
        (remove-state $Var)) 
      (do 
        (add-atom &amp;memory 
          (state $Var $Value))))))
</span><span class="ansi38-255165000">(@ = load 
  (metta_defn  &amp;self 
    (get-state $Var) 
    (match &amp;memory 
      (state $Var $Value) $Value)))
</span>; Earlier, `(get-state (person name))` got cached, and it changes
; in one equality for `listen` didn''t affect other equalities.
; `case` accepts an `Atom` and forcefully evaluates it.
; However, the idea of using equalities as sequentially processed
; rules with side effects is still questionable
<span class="ansi38-255165000">(@ = load 
  (metta_defn  &amp;self 
    (listen 
      (My name is $X)) 
    (case 
      (get-state 
        (person name)) 
      ( ($X 
          ("Yes," I remember)) 
        ($Y 
          (I thought you are $Y))))))
</span>; $y cannot be %void%
<span class="ansi38-255165000">(@ = load 
  (metta_defn  &amp;self 
    (listen 
      (My name is $X)) 
    (change-state 
      (person name) $X)))
</span><span class="ansi38-255165000">(@ = load 
  (metta_defn  &amp;self 
    (listen $_) 
    (case 
      (get-state greeted) 
      ( (%void% 
          (case 
            (get-state 
              (person name)) 
            ( (%void% 
                (Hi. What is your name?)) 
              ($P_name 
                (Nice to meet you $P_name)))))))))
</span><span class="ansi38-255165000">(@ = load 
  (metta_defn  &amp;self 
    (listen $_) 
    (nop 
      (change-state greeted True))))
</span><span class="ansi32">% 90,910 inferences, 0.052 CPU in 0.052 seconds (100% CPU, 1750778 Lips)
</span> (@ = "/opt/logicmoo_workspace/packs_sys/logicmoo_opencog/MeTTa/vspace-metta/examples/compat/test_scripts/_e2_states_dia.metta" 0)
doing(ansi2html &lt; "/opt/logicmoo_workspace/packs_sys/logicmoo_opencog/MeTTa/vspace-metta/TEE.ansi" &gt; "/opt/logicmoo_workspace/packs_sys/logicmoo_opencog/MeTTa/vspace-metta/examples/compat/test_scripts/_e2_states_dia.html" )
 --args
 --timeout=20

Script done on 2023-09-25 06:54:22-07:00 [COMMAND_EXIT_CODE="7"]

</pre>
</body>

</html>
